<div class="container w-auto text-center">
  <div class="container overflow-hidden w-50 mt-4 mb-0 px-2 text-center">
    <div class="row mt-5">
      <span class="h1 card-header">Roster for {{ getMonthName(month) }} {{ year }}</span>
      <div class="row gx-2">
        <div class="col form-control m-2">
          <label class="form-select-label">Month</label>
          <select (change)="createCalendar()" [(ngModel)]="month" class="form-select">
            <option *ngFor="let monthChose of monthToChoose"
                    class="text-center form-select" value="{{ monthChose }}"> {{ getMonthName(monthChose) }} </option>
          </select>
        </div>
        <div class="col form-control m-2">
          <label class="form-select-label">Year</label>
          <select (change)="createCalendar()" [(ngModel)]="year" class="form-select">
            <option *ngFor="let year of yearsToChoose" class="text-center form-select"
                    value="{{ year }}"> {{ year }} </option>
          </select>
        </div>
        <div class="col form-control m-2 form-check">
          <label class="form-select-label">Select a Team</label>
          <select (change)="createCalendar()" [(ngModel)]="selectedTeamId" class="form-select">
            <option *ngFor="let team of teams" [value]="team.id"
                    class="text-center form-select"> {{ team.name }} </option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <ng-container *ngIf="selectedTeam">

    <div class="text-center">
      <button (click)="generateNewRoster()" class="btn btn-outline-primary m-3" type="button">Generate a new Roster
      </button>
      <button (click)="saveNewRoster()" *ngIf="enableSaveRoster" class="btn btn-outline-success m-3" type="button">Save
        the new Roster
      </button>
      <button (click)="clearGeneratedValues()" *ngIf="enableSaveRoster" class="btn btn-outline-info m-3" type="button">
        Clear Generated Values
      </button>
    </div>

    <div class="container-fluid p-3 my-3 mb-5">
      <table class="table table-striped table-hover">
        <thead>
        <tr>
          <th scope="col">Day</th>
          <th scope="col">Compulsory</th>
          <th *ngFor="let employee of employees" scope="col">
            <p>{{ employee.firstName }} {{ employee.lastName }}</p>
            <p class="small text-secondary">{{ employee.hoursPerWeek }} hours per week</p>
          </th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let day of days">
          <td
            [ngClass]="returnDayName(day) == 'Saturday'  || returnDayName(day) == 'Sunday' ? 'table-danger' : ''"
            class="fw-bold">{{ day }}
            . {{ returnDayName(day) }}</td>
          <td
            [ngClass]="returnDayName(day) == 'Saturday'  || returnDayName(day) == 'Sunday' ? 'table-danger' : ''">{{ returnCompulsory(day) }}</td>

          <td *ngFor="let employee of employees"
              [ngClass]="returnDayName(day) == 'Saturday'  || returnDayName(day) == 'Sunday' ? 'table-danger' : ''">
            <ng-container *ngIf="predefinedPeriods">
              <ng-container *ngFor="let period of predefinedPeriods">
                <ng-container
                  *ngIf="period.employee == employee.id && period.dateFrom.substring(8,10) == addNull(day)">
                  <ng-container [ngSwitch]="period.purpose">
                    <b *ngSwitchCase="'WORKING_HOURS'">
                      {{period.dateFrom.substring(period.dateFrom.length - 5, period.dateFrom.length)}} -
                      {{period.dateTo.substring(period.dateTo.length - 5, period.dateTo.length)}}
                    </b>
                    <span *ngSwitchCase="'CONFIRMED_VACATION'" class="text-info">Vacation</span>
                    <span *ngSwitchCase="'SICK_LEAVE'" class="text-primary">Sick Leave</span>
                    <span *ngSwitchCase="'VACATION_REQUEST'" class="text-secondary">Vacation Request</span>
                    <span *ngSwitchCase="'WORKING_HOUR_REQUEST'" class="text-secondary">
                    {{period.dateFrom.substring(period.dateFrom.length - 5, period.dateFrom.length)}} -
                      {{period.dateTo.substring(period.dateTo.length - 5, period.dateTo.length)}}
                      (Request)
                  </span>
                    <span *ngSwitchCase="'ABSENCE'" class="text-primary">
                    {{period.dateFrom.substring(period.dateFrom.length - 5, period.dateFrom.length)}} -
                      {{period.dateTo.substring(period.dateTo.length - 5, period.dateTo.length)}}
                      (Absence)
                  </span>
                    <span *ngSwitchCase="'FREE_TIME_REQUEST'" class="text-secondary">
                    {{period.dateFrom.substring(period.dateFrom.length - 5, period.dateFrom.length)}} -
                      {{period.dateTo.substring(period.dateTo.length - 5, period.dateTo.length)}}
                      (Free-Time Request)
                  </span>
                  </ng-container>
                </ng-container>
              </ng-container>
            </ng-container>
          </td>
        </tr>
        <tr class="table-primary">
          <td class="fw-bold">Hours Worked</td>
          <td></td>
          <td *ngFor="let employee of employees">
            <p>
              <ng-container *ngIf="workingPeriods">
                <ng-container *ngFor="let workingPeriod of workingPeriods">
                  <ng-container *ngIf="workingPeriod.employeeId == employee.id">
                    {{ workingPeriod.workingTime.toFixed(2) }}
                  </ng-container>
                </ng-container>
              </ng-container>
            </p>
          </td>
        </tr>
        <tr class="table-primary">
          <td class="fw-bold">Balance Hours</td>
          <td></td>
          <td *ngFor="let employee of employees">
            <p
              [ngClass]="employee.balanceHours.toString().startsWith('-') ? 'text-danger' : 'text-success'">{{ employee.balanceHours.toFixed(2) }}</p>
          </td>
        </tr>
        <tr class="table-primary">
          <td class="fw-bold">Total</td>
          <td>(Hours Worked + Balance Hours)</td>
          <td *ngFor="let employee of employees">
            <p>
              <ng-container *ngIf="workingPeriods">
                <ng-container *ngFor="let workingPeriod of workingPeriods">
                  <ng-container *ngIf="workingPeriod.employeeId == employee.id">
                  <span
                    [ngClass]="returnTotal(workingPeriod.workingTime, employee).toString().startsWith('-') ? 'text-danger' : 'text-success'">
                                      {{ returnTotal(workingPeriod.workingTime, employee) }}
                  </span>
                  </ng-container>
                </ng-container>
              </ng-container>
            </p>
          </td>
        </tr>
        <tr class="table-primary">
          <td class="fw-bold">Compulsory</td>
          <td></td>
          <td *ngFor="let employee of employees">
            <p>
              {{ returnMonthlyWorkingHours(employee).toFixed(2) }}
            </p>
          </td>
        </tr>
        <tr class="table-info fw-bold">
          <td>Difference</td>
          <td>(New balance)</td>
          <td *ngFor="let employee of employees">
            <p>
              <ng-container *ngIf="workingPeriods">
                <ng-container *ngFor="let workingPeriod of workingPeriods">
                  <ng-container *ngIf="workingPeriod.employeeId == employee.id">
                  <span
                    [ngClass]="returnNewBalance(workingPeriod.workingTime, employee).toString().startsWith('-') ? 'text-danger' : 'text-success'">
                                      {{ returnNewBalance(workingPeriod.workingTime, employee) }}
                  </span>
                  </ng-container>
                </ng-container>
              </ng-container>
            </p>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </ng-container>
</div>
